<h1>body-parser</h1>
<pre><code class="lang-js"><span class="comment">/*!
 * body-parser
 * Copyright(c) 2014 Douglas Christopher Wilson
 * MIT Licensed
 */</span>

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> deprecate = require(<span class="string">'depd'</span>)(<span class="string">'body-parser'</span>)
<span class="keyword">var</span> fs = require(<span class="string">'fs'</span>)
<span class="keyword">var</span> path = require(<span class="string">'path'</span>)

<span class="comment">/**
 * Module exports.
 */</span>

exports = module.exports = deprecate.<span class="keyword">function</span>(bodyParser,
  <span class="string">'bodyParser: use individual json/urlencoded middlewares'</span>)

<span class="comment">/**
 * Path to the parser modules.
 */</span>

<span class="keyword">var</span> parsersDir = path.join(__dirname, <span class="string">'lib'</span>, <span class="string">'types'</span>)

<span class="comment">/**
 * Auto-load bundled parsers with getters.
 */</span>

fs.readdirSync(parsersDir).forEach(<span class="function"><span class="keyword">function</span> <span class="title">onfilename</span><span class="params">(filename)</span> {</span>
  <span class="keyword">if</span> (!<span class="regexp">/\.js$/</span>.test(filename)) <span class="keyword">return</span>

  <span class="keyword">var</span> loc = path.resolve(parsersDir, filename)
  <span class="keyword">var</span> mod
  <span class="keyword">var</span> name = path.basename(filename, <span class="string">'.js'</span>)

  <span class="function"><span class="keyword">function</span> <span class="title">load</span><span class="params">()</span> {</span>
    <span class="keyword">if</span> (mod) {
      <span class="keyword">return</span> mod
    }

    <span class="keyword">return</span> mod = require(loc)
  }

  Object.defineProperty(exports, name, {
    configurable: <span class="literal">true</span>,
    enumerable: <span class="literal">true</span>,
    get: load
  })
})

<span class="comment">/**
 * Create a middleware to parse json and urlencoded bodies.
 *
 * @param {object} [options]
 * @return {function}
 * @deprecated
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">bodyParser</span><span class="params">(options)</span>{</span>
  <span class="keyword">var</span> opts = {}

  options = options || {}

  <span class="comment">// exclude type option</span>
  <span class="keyword">for</span> (<span class="keyword">var</span> prop <span class="keyword">in</span> options) {
    <span class="keyword">if</span> (<span class="string">'type'</span> !== prop) {
      opts[prop] = options[prop]
    }
  }

  <span class="keyword">var</span> _urlencoded = exports.urlencoded(opts)
  <span class="keyword">var</span> _json = exports.json(opts)

  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">bodyParser</span><span class="params">(req, res, next)</span> {</span>
    _json(req, res, <span class="keyword">function</span>(err){
      <span class="keyword">if</span> (err) <span class="keyword">return</span> next(err);
      _urlencoded(req, res, next);
    });
  }
}
</code></pre>