<h1>query.js</h1>
<pre><code class="lang-js"><span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> parseUrl = require(<span class="string">'parseurl'</span>);
<span class="keyword">var</span> qs = require(<span class="string">'qs'</span>);

<span class="comment">/**
 * @param {Object} options
 * @return {Function}
 * @api public
 */</span>

module.exports = <span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">(options)</span> {</span>
  <span class="keyword">var</span> queryparse = qs.parse;

  <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">'function'</span>) {
    queryparse = options;
    options = <span class="literal">undefined</span>;
  }

  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">(req, res, next)</span>{</span>
    <span class="keyword">if</span> (!req.query) {
      <span class="keyword">var</span> val = parseUrl(req).query;
      req.query = queryparse(val, options);
    }

    next();
  };
};
</code></pre>