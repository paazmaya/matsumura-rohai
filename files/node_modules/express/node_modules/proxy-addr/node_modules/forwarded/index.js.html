<h1>forwarded</h1>
<pre><code class="lang-js"><span class="comment">/*!
 * forwarded
 * Copyright(c) 2014 Douglas Christopher Wilson
 * MIT Licensed
 */</span>

<span class="comment">/**
 * Module exports.
 */</span>

module.exports = forwarded

<span class="comment">/**
 * Get all addresses in the request, using the `X-Forwarded-For` header.
 *
 * @param {Object} req
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">forwarded</span><span class="params">(req)</span> {</span>
  <span class="keyword">if</span> (!req) {
    <span class="keyword">throw</span> <span class="keyword">new</span> TypeError(<span class="string">'argument req is required'</span>)
  }

  <span class="comment">// simple header parsing</span>
  <span class="keyword">var</span> proxyAddrs = (req.headers[<span class="string">'x-forwarded-for'</span>] || <span class="string">''</span>)
    .split(<span class="regexp">/ *, */</span>)
    .filter(Boolean)
    .reverse()
  <span class="keyword">var</span> socketAddr = req.connection.remoteAddress
  <span class="keyword">var</span> addrs = [socketAddr].concat(proxyAddrs)

  <span class="comment">// return all addresses</span>
  <span class="keyword">return</span> addrs
}
</code></pre>