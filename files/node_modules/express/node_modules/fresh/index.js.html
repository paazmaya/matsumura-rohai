<h1>fresh</h1>
<pre><code class="lang-js"><span class="comment">/**
 * Expose `fresh()`.
 */</span>

module.exports = fresh;

<span class="comment">/**
 * Check freshness of `req` and `res` headers.
 *
 * When the cache is "fresh" __true__ is returned,
 * otherwise __false__ is returned to indicate that
 * the cache is now stale.
 *
 * @param {Object} req
 * @param {Object} res
 * @return {Boolean}
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">fresh</span><span class="params">(req, res)</span> {</span>
  <span class="comment">// defaults</span>
  <span class="keyword">var</span> etagMatches = <span class="literal">true</span>;
  <span class="keyword">var</span> notModified = <span class="literal">true</span>;

  <span class="comment">// fields</span>
  <span class="keyword">var</span> modifiedSince = req[<span class="string">'if-modified-since'</span>];
  <span class="keyword">var</span> noneMatch = req[<span class="string">'if-none-match'</span>];
  <span class="keyword">var</span> lastModified = res[<span class="string">'last-modified'</span>];
  <span class="keyword">var</span> etag = res[<span class="string">'etag'</span>];
  <span class="keyword">var</span> cc = req[<span class="string">'cache-control'</span>];

  <span class="comment">// unconditional request</span>
  <span class="keyword">if</span> (!modifiedSince &amp;&amp; !noneMatch) <span class="keyword">return</span> <span class="literal">false</span>;

  <span class="comment">// check for no-cache cache request directive</span>
  <span class="keyword">if</span> (cc &amp;&amp; cc.indexOf(<span class="string">'no-cache'</span>) !== -<span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;  

  <span class="comment">// parse if-none-match</span>
  <span class="keyword">if</span> (noneMatch) noneMatch = noneMatch.split(<span class="regexp">/ *, */</span>);

  <span class="comment">// if-none-match</span>
  <span class="keyword">if</span> (noneMatch) etagMatches = ~noneMatch.indexOf(etag) || <span class="string">'*'</span> == noneMatch[<span class="number">0</span>];

  <span class="comment">// if-modified-since</span>
  <span class="keyword">if</span> (modifiedSince) {
    modifiedSince = <span class="keyword">new</span> Date(modifiedSince);
    lastModified = <span class="keyword">new</span> Date(lastModified);
    notModified = lastModified &lt;= modifiedSince;
  }

  <span class="keyword">return</span> !! (etagMatches &amp;&amp; notModified);
}</code></pre>