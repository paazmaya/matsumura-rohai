<h1>stringify.js</h1>
<pre><code class="lang-js"><span class="comment">// Load modules</span>

<span class="keyword">var</span> Utils = require(<span class="string">'./utils'</span>);


<span class="comment">// Declare internals</span>

<span class="keyword">var</span> internals = {
    delimiter: <span class="string">'&amp;'</span>
};


internals.stringify = <span class="function"><span class="keyword">function</span> <span class="params">(obj, prefix)</span> {</span>

    <span class="keyword">if</span> (Utils.isBuffer(obj)) {
        obj = obj.toString();
    }
    <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Date) {
        obj = obj.toISOString();
    }
    <span class="keyword">else</span> <span class="keyword">if</span> (obj === <span class="literal">null</span>) {
        obj = <span class="string">''</span>;
    }

    <span class="keyword">if</span> (<span class="keyword">typeof</span> obj === <span class="string">'string'</span> ||
        <span class="keyword">typeof</span> obj === <span class="string">'number'</span> ||
        <span class="keyword">typeof</span> obj === <span class="string">'boolean'</span>) {

        <span class="keyword">return</span> [encodeURIComponent(prefix) + <span class="string">'='</span> + encodeURIComponent(obj)];
    }

    <span class="keyword">var</span> values = [];

    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) {
        <span class="keyword">if</span> (obj.hasOwnProperty(key)) {
            values = values.concat(internals.stringify(obj[key], prefix + <span class="string">'['</span> + key + <span class="string">']'</span>));
        }
    }

    <span class="keyword">return</span> values;
};


module.exports = <span class="function"><span class="keyword">function</span> <span class="params">(obj, options)</span> {</span>

    options = options || {};
    <span class="keyword">var</span> delimiter = <span class="keyword">typeof</span> options.delimiter === <span class="string">'undefined'</span> ? internals.delimiter : options.delimiter;

    <span class="keyword">var</span> keys = [];

    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) {
        <span class="keyword">if</span> (obj.hasOwnProperty(key)) {
            keys = keys.concat(internals.stringify(obj[key], key));
        }
    }

    <span class="keyword">return</span> keys.join(delimiter);
};
</code></pre>