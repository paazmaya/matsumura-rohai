<h1>negotiator</h1>
<pre><code class="lang-js">module.exports = Negotiator;
Negotiator.Negotiator = Negotiator;

<span class="function"><span class="keyword">function</span> <span class="title">Negotiator</span><span class="params">(request)</span> {</span>
  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> Negotiator)) <span class="keyword">return</span> <span class="keyword">new</span> Negotiator(request);
  <span class="keyword">this</span>.request = request;
}

<span class="keyword">var</span> set = { charset: <span class="string">'accept-charset'</span>,
            encoding: <span class="string">'accept-encoding'</span>,
            language: <span class="string">'accept-language'</span>,
            mediaType: <span class="string">'accept'</span> };


<span class="function"><span class="keyword">function</span> <span class="title">capitalize</span><span class="params">(string)</span>{</span>
  <span class="keyword">return</span> string.charAt(<span class="number">0</span>).toUpperCase() + string.slice(<span class="number">1</span>);
}

Object.keys(set).forEach(<span class="function"><span class="keyword">function</span> <span class="params">(k)</span> {</span>
  <span class="keyword">var</span> header = set[k],
      method = require(<span class="string">'./'</span>+k+<span class="string">'.js'</span>),
      singular = k,
      plural = k + <span class="string">'s'</span>;

  Negotiator.prototype[plural] = <span class="function"><span class="keyword">function</span> <span class="params">(available)</span> {</span>
    <span class="keyword">return</span> method(<span class="keyword">this</span>.request.headers[header], available);
  };

  Negotiator.prototype[singular] = <span class="keyword">function</span>(available) {
    <span class="keyword">var</span> set = <span class="keyword">this</span>[plural](available);
    <span class="keyword">if</span> (set) <span class="keyword">return</span> set[<span class="number">0</span>];
  };

  <span class="comment">// Keep preferred* methods for legacy compatibility</span>
  Negotiator.prototype[<span class="string">'preferred'</span>+capitalize(plural)] = Negotiator.prototype[plural];
  Negotiator.prototype[<span class="string">'preferred'</span>+capitalize(singular)] = Negotiator.prototype[singular];
})
</code></pre>