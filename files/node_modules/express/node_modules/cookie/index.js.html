<h1>cookie</h1>
<pre><code class="lang-js"><span class="comment">/// Serialize the a name value pair into a cookie string suitable for</span>
<span class="comment">/// http headers. An optional options object specified cookie parameters</span>
<span class="comment">///</span>
<span class="comment">/// serialize('foo', 'bar', { httpOnly: true })</span>
<span class="comment">///   => "foo=bar; httpOnly"</span>
<span class="comment">///</span>
<span class="comment">/// @param {String} name</span>
<span class="comment">/// @param {String} val</span>
<span class="comment">/// @param {Object} options</span>
<span class="comment">/// @return {String}</span>
<span class="keyword">var</span> serialize = <span class="keyword">function</span>(name, val, opt){
    opt = opt || {};
    <span class="keyword">var</span> enc = opt.encode || encode;
    <span class="keyword">var</span> pairs = [name + <span class="string">'='</span> + enc(val)];

    <span class="keyword">if</span> (<span class="literal">null</span> != opt.maxAge) {
        <span class="keyword">var</span> maxAge = opt.maxAge - <span class="number">0</span>;
        <span class="keyword">if</span> (isNaN(maxAge)) <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'maxAge should be a Number'</span>);
        pairs.push(<span class="string">'Max-Age='</span> + maxAge);
    }

    <span class="keyword">if</span> (opt.domain) pairs.push(<span class="string">'Domain='</span> + opt.domain);
    <span class="keyword">if</span> (opt.path) pairs.push(<span class="string">'Path='</span> + opt.path);
    <span class="keyword">if</span> (opt.expires) pairs.push(<span class="string">'Expires='</span> + opt.expires.toUTCString());
    <span class="keyword">if</span> (opt.httpOnly) pairs.push(<span class="string">'HttpOnly'</span>);
    <span class="keyword">if</span> (opt.secure) pairs.push(<span class="string">'Secure'</span>);

    <span class="keyword">return</span> pairs.join(<span class="string">'; '</span>);
};

<span class="comment">/// Parse the given cookie header string into an object</span>
<span class="comment">/// The object has the various cookies as keys(names) => values</span>
<span class="comment">/// @param {String} str</span>
<span class="comment">/// @return {Object}</span>
<span class="keyword">var</span> parse = <span class="keyword">function</span>(str, opt) {
    opt = opt || {};
    <span class="keyword">var</span> obj = {}
    <span class="keyword">var</span> pairs = str.split(<span class="regexp">/; */</span>);
    <span class="keyword">var</span> dec = opt.decode || decode;

    pairs.forEach(<span class="keyword">function</span>(pair) {
        <span class="keyword">var</span> eq_idx = pair.indexOf(<span class="string">'='</span>)

        <span class="comment">// skip things that don't look like key=value</span>
        <span class="keyword">if</span> (eq_idx &lt; <span class="number">0</span>) {
            <span class="keyword">return</span>;
        }

        <span class="keyword">var</span> key = pair.substr(<span class="number">0</span>, eq_idx).trim()
        <span class="keyword">var</span> val = pair.substr(++eq_idx, pair.length).trim();

        <span class="comment">// quoted values</span>
        <span class="keyword">if</span> (<span class="string">'"'</span> == val[<span class="number">0</span>]) {
            val = val.slice(<span class="number">1</span>, -<span class="number">1</span>);
        }

        <span class="comment">// only assign once</span>
        <span class="keyword">if</span> (<span class="literal">undefined</span> == obj[key]) {
            <span class="keyword">try</span> {
                obj[key] = dec(val);
            } <span class="keyword">catch</span> (e) {
                obj[key] = val;
            }
        }
    });

    <span class="keyword">return</span> obj;
};

<span class="keyword">var</span> encode = encodeURIComponent;
<span class="keyword">var</span> decode = decodeURIComponent;

module.exports.serialize = serialize;
module.exports.parse = parse;
</code></pre>