<h1>destroy</h1>
<pre><code class="lang-js"><span class="keyword">var</span> ReadStream = require(<span class="string">'fs'</span>).ReadStream
<span class="keyword">var</span> Stream = require(<span class="string">'stream'</span>)

module.exports = <span class="function"><span class="keyword">function</span> <span class="title">destroy</span><span class="params">(stream)</span> {</span>
  <span class="keyword">if</span> (stream <span class="keyword">instanceof</span> ReadStream) {
    <span class="keyword">return</span> destroyReadStream(stream)
  }

  <span class="keyword">if</span> (!(stream <span class="keyword">instanceof</span> Stream)) {
    <span class="keyword">return</span> stream
  }

  <span class="keyword">if</span> (<span class="keyword">typeof</span> stream.destroy === <span class="string">'function'</span>) {
    stream.destroy()
  }

  <span class="keyword">return</span> stream
}

<span class="function"><span class="keyword">function</span> <span class="title">destroyReadStream</span><span class="params">(stream)</span> {</span>
  stream.destroy()

  <span class="keyword">if</span> (<span class="keyword">typeof</span> stream.close === <span class="string">'function'</span>) {
    <span class="comment">// node.js core bug work-around</span>
    stream.on(<span class="string">'open'</span>, onopenClose)
  }

  <span class="keyword">return</span> stream
}

<span class="function"><span class="keyword">function</span> <span class="title">onopenClose</span><span class="params">()</span> {</span>
  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.fd === <span class="string">'number'</span>) {
    <span class="comment">// actually close down the fd</span>
    <span class="keyword">this</span>.close()
  }
}
</code></pre>