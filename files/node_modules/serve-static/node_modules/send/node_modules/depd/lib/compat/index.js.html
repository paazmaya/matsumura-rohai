<h1>index.js</h1>
<pre><code class="lang-js"><span class="comment">/*!
 * depd
 * Copyright(c) 2014 Douglas Christopher Wilson
 * MIT Licensed
 */</span>

<span class="comment">/**
 * Module exports.
 */</span>

lazyProperty(module.exports, <span class="string">'bufferConcat'</span>, <span class="function"><span class="keyword">function</span> <span class="title">bufferConcat</span><span class="params">()</span> {</span>
  <span class="keyword">return</span> Buffer.concat || require(<span class="string">'./buffer-concat'</span>)
})

lazyProperty(module.exports, <span class="string">'callSiteToString'</span>, <span class="function"><span class="keyword">function</span> <span class="title">callSiteToString</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> limit = Error.stackTraceLimit
  <span class="keyword">var</span> obj = {}
  <span class="keyword">var</span> prep = Error.prepareStackTrace

  <span class="function"><span class="keyword">function</span> <span class="title">prepareObjectStackTrace</span><span class="params">(obj, stack)</span> {</span>
    <span class="keyword">return</span> stack
  }

  Error.prepareStackTrace = prepareObjectStackTrace
  Error.stackTraceLimit = <span class="number">2</span>

  <span class="comment">// capture the stack</span>
  Error.captureStackTrace(obj)

  <span class="comment">// slice the stack</span>
  <span class="keyword">var</span> stack = obj.stack.slice()

  Error.prepareStackTrace = prep
  Error.stackTraceLimit = limit

  <span class="keyword">return</span> stack[<span class="number">0</span>].toString ? toString : require(<span class="string">'./callsite-tostring'</span>)
})

<span class="comment">/**
 * Define a lazy property.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">lazyProperty</span><span class="params">(obj, prop, getter)</span> {</span>
  <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> val = getter()

    Object.defineProperty(obj, prop, {
      configurable: <span class="literal">true</span>,
      enumerable: <span class="literal">true</span>,
      value: val
    })

    <span class="keyword">return</span> val
  }

  Object.defineProperty(obj, prop, {
    configurable: <span class="literal">true</span>,
    enumerable: <span class="literal">true</span>,
    get: get
  })
}

<span class="comment">/**
 * Call toString() on the obj
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">toString</span><span class="params">(obj)</span> {</span>
  <span class="keyword">return</span> obj.toString()
}
</code></pre>