<h1>range-parser</h1>
<pre><code class="lang-js"><span class="comment">/**
 * Parse "Range" header `str` relative to the given file `size`.
 *
 * @param {Number} size
 * @param {String} str
 * @return {Array}
 * @api public
 */</span>

module.exports = <span class="keyword">function</span>(size, str){
  <span class="keyword">var</span> valid = <span class="literal">true</span>;
  <span class="keyword">var</span> i = str.indexOf(<span class="string">'='</span>);

  <span class="keyword">if</span> (-<span class="number">1</span> == i) <span class="keyword">return</span> -<span class="number">2</span>;

  <span class="keyword">var</span> arr = str.slice(i + <span class="number">1</span>).split(<span class="string">','</span>).map(<span class="keyword">function</span>(range){
    <span class="keyword">var</span> range = range.split(<span class="string">'-'</span>)
      , start = parseInt(range[<span class="number">0</span>], <span class="number">10</span>)
      , end = parseInt(range[<span class="number">1</span>], <span class="number">10</span>);

    <span class="comment">// -nnn</span>
    <span class="keyword">if</span> (isNaN(start)) {
      start = size - end;
      end = size - <span class="number">1</span>;
    <span class="comment">// nnn-</span>
    } <span class="keyword">else</span> <span class="keyword">if</span> (isNaN(end)) {
      end = size - <span class="number">1</span>;
    }

    <span class="comment">// limit last-byte-pos to current length</span>
    <span class="keyword">if</span> (end > size - <span class="number">1</span>) end = size - <span class="number">1</span>;

    <span class="comment">// invalid</span>
    <span class="keyword">if</span> (isNaN(start)
      || isNaN(end)
      || start > end
      || start &lt; <span class="number">0</span>) valid = <span class="literal">false</span>;

    <span class="keyword">return</span> {
      start: start,
      end: end
    };
  });

  arr.type = str.slice(<span class="number">0</span>, i);

  <span class="keyword">return</span> valid ? arr : -<span class="number">1</span>;
};
</code></pre>