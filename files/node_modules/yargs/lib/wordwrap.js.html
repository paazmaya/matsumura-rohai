<h1>wordwrap.js</h1>
<pre><code class="lang-js"><span class="comment">// Simplified version of https://github.com/substack/node-wordwrap</span>

<span class="string">'use strict'</span>;

module.exports = <span class="function"><span class="keyword">function</span> <span class="params">(start, stop)</span> {</span>

    <span class="keyword">if</span> (!stop) {
        stop = start;
        start = <span class="number">0</span>;
    }

    <span class="keyword">var</span> re = <span class="regexp">/(\S+\s+)/</span>;

    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(text)</span> {</span>
        <span class="keyword">var</span> chunks = text.toString().split(re);

        <span class="keyword">return</span> chunks.reduce(<span class="function"><span class="keyword">function</span> <span class="params">(lines, rawChunk)</span> {</span>
            <span class="keyword">if</span> (rawChunk === <span class="string">''</span>) <span class="keyword">return</span> lines;

            <span class="keyword">var</span> chunk = rawChunk.replace(<span class="regexp">/\t/g</span>, <span class="string">'    '</span>);

            <span class="keyword">var</span> i = lines.length - <span class="number">1</span>;
            <span class="keyword">if</span> (lines[i].length + chunk.length > stop) {
                lines[i] = lines[i].replace(<span class="regexp">/\s+$/</span>, <span class="string">''</span>);

                chunk.split(<span class="regexp">/\n/</span>).forEach(<span class="function"><span class="keyword">function</span> <span class="params">(c)</span> {</span>
                    lines.push(
                        <span class="keyword">new</span> Array(start + <span class="number">1</span>).join(<span class="string">' '</span>)
                            + c.replace(<span class="regexp">/^\s+/</span>, <span class="string">''</span>)
                    );
                });
            }
            <span class="keyword">else</span> <span class="keyword">if</span> (chunk.match(<span class="regexp">/\n/</span>)) {
                <span class="keyword">var</span> xs = chunk.split(<span class="regexp">/\n/</span>);
                lines[i] += xs.shift();
                xs.forEach(<span class="function"><span class="keyword">function</span> <span class="params">(c)</span> {</span>
                    lines.push(
                        <span class="keyword">new</span> Array(start + <span class="number">1</span>).join(<span class="string">' '</span>)
                            + c.replace(<span class="regexp">/^\s+/</span>, <span class="string">''</span>)
                    );
                });
            }
            <span class="keyword">else</span> {
                lines[i] += chunk;
            }

            <span class="keyword">return</span> lines;
        }, [ <span class="keyword">new</span> Array(start + <span class="number">1</span>).join(<span class="string">' '</span>) ]).join(<span class="string">'\n'</span>);
    };
};</code></pre>